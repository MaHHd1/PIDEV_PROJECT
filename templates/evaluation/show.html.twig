{# templates/evaluation/show.html.twig #}
{% extends 'enseignant/prof_base.html.twig' %}

{% block title %}Détails de l'évaluation{% endblock %}

{% block main_content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Détails de l'évaluation</h1>
        <div>
            <a href="{{ path('app_evaluation_edit', {'id': evaluation.id}) }}" class="btn btn-warning">
                Modifier
            </a>
            <a href="{{ path('app_evaluation_index') }}" class="btn btn-secondary">
                Retour à la liste
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">{{ evaluation.titre }}</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <th width="40%">ID</th>
                                <td>{{ evaluation.id }}</td>
                            </tr>
                            <tr>
                                <th>Type d'évaluation</th>
                                <td><span class="badge bg-info">{{ evaluation.typeEvaluation }}</span></td>
                            </tr>
                            <tr>
                                <th>Cours</th>
                                <td>{{ evaluation.idCours }}</td>
                            </tr>
                            <tr>
                                <th>Enseignant</th>
                                <td>{{ evaluation.idEnseignant }}</td>
                            </tr>
                            <tr>
                                <th>Date de création</th>
                                <td>{{ evaluation.dateCreation|date('d/m/Y H:i') }}</td>
                            </tr>
                            <tr>
                                <th>Date limite</th>
                                <td>
                                    {{ evaluation.dateLimite|date('d/m/Y H:i') }}
                                    {% if evaluation.dateLimite < date() %}
                                        <span class="badge bg-danger">Expirée</span>
                                    {% else %}
                                        <span class="badge bg-success">Active</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="col-md-6">
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <th width="40%">Note maximale</th>
                                <td><strong>{{ evaluation.noteMax }}</strong> points</td>
                            </tr>
                            <tr>
                                <th>Mode de remise</th>
                                <td>
                                    {% if evaluation.modeRemise == 'en_ligne' %}
                                        <span class="badge bg-primary">En ligne</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Présentiel</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>Statut</th>
                                <td>
                                    {% if evaluation.statut == 'ouverte' %}
                                        <span class="badge bg-success">Ouverte</span>
                                    {% else %}
                                        <span class="badge bg-danger">Fermée</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>Description</th>
                                <td>{{ evaluation.description ?? 'Aucune description' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            {% if evaluation.description %}
            <div class="mt-4">
                <h4>Description complète</h4>
                <div class="alert alert-info">
                    {{ evaluation.description|nl2br }}
                </div>
            </div>
            {% endif %}

            <!-- Liste des soumissions associées -->
            <div class="mt-4">
                <h4>Soumissions ({{ evaluation.soumissions|length }})</h4>
                {% if evaluation.soumissions|length > 0 %}
                    <table class="table table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>ID Étudiant</th>
                                <th>Date de soumission</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for soumission in evaluation.soumissions %}
                            <tr>
                                <td>{{ soumission.idEtudiant }}</td>
                                <td>{{ soumission.dateSoumission|date('d/m/Y H:i') }}</td>
                                <td>
                                    {% if soumission.statut == 'soumise' %}
                                        <span class="badge bg-success">Soumise</span>
                                    {% elseif soumission.statut == 'en_retard' %}
                                        <span class="badge bg-warning">En retard</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Non soumise</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ path('app_soumission_show', {'id': soumission.id}) }}" class="btn btn-sm btn-info">Voir</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="alert alert-warning">
                        Aucune soumission pour cette évaluation.
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="card-footer">
            <form method="post" action="{{ path('app_evaluation_delete', {'id': evaluation.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette évaluation ?');" class="d-inline">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ evaluation.id) }}">
                <button class="btn btn-danger">Supprimer</button>
            </form>
            <a href="{{ path('app_evaluation_edit', {'id': evaluation.id}) }}" class="btn btn-warning">Modifier</a>
            <a href="{{ path('app_evaluation_index') }}" class="btn btn-secondary">Retour</a>
        </div>
    </div>
</div>
{% endblock %}
