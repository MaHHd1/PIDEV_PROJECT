{% extends 'base.html.twig' %}
{% block title %}Forums{% endblock %}

{% block body %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">üí¨ Forums</h3>
  <a class="btn btn-primary" href="{{ path('forum_new', {u: activeUser.id}) }}">+ Nouveau forum</a>
</div>

<form class="row g-2 mb-3" method="get" action="{{ path('forum_list') }}">
  <input type="hidden" name="u" value="{{ activeUser.id }}">
  <div class="col-md-8">
    <input class="form-control" name="q" value="{{ q }}" placeholder="Rechercher (titre ou description)...">
  </div>
  <div class="col-md-2">
    <button class="btn btn-outline-dark w-100">Rechercher</button>
  </div>
</form>

<div class="text-muted mb-2">Total: {{ total }} | page {{ page }}/{{ pages }}</div>

<div class="row g-3">
  {% for f in forums %}
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">

          <div class="d-flex justify-content-between">
            <h5 class="card-title mb-1">
            {{ f.titre }}
            {% if f.estModifie %}
                <span class="badge text-bg-warning ms-2">modifi√©</span>
            {% endif %}
            </h5>
            {% if f.estModifie and f.dateModification %}
            <small class="text-muted">Modifi√© le {{ f.dateModification|date('Y-m-d H:i') }}</small>
            {% endif %}
            <span class="badge text-bg-secondary">{{ f.type }}</span>
          </div>

          <p class="card-text text-muted mb-2">
            {{ f.description|slice(0, 140) }}
            {% if f.description|length > 140 %}...{% endif %}
          </p>

          <div class="d-flex justify-content-between align-items-center">

            <div>
              <small class="text-muted">
                Vues: {{ f.nombreVues }}
                |
                {{ f.derniereActivite ? f.derniereActivite|date('Y-m-d H:i') : '' }}
                <br>
                üëç {{ f.likes ?? 0 }}
                ‚Ä¢ üëé {{ f.dislikes ?? 0 }}
                ‚Ä¢ üö© {{ f.signalements ?? 0 }}
              </small>
            </div>

            <a class="btn btn-sm btn-outline-primary"
               href="{{ path('forum_show', {id: f.id, u: activeUser.id}) }}">
               Ouvrir
            </a>

          </div>

        </div>
      </div>
    </div>

  {% else %}
    <div class="col-12">
      <div class="alert alert-info">Aucun forum trouv√©.</div>
    </div>
  {% endfor %}
</div>

<nav class="mt-4">
  <ul class="pagination">
    {% for p in 1..pages %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="{{ path('forum_list', {u: activeUser.id, page: p, q: q}) }}">{{ p }}</a>
      </li>
    {% endfor %}
  </ul>
</nav>
{% endblock %}
